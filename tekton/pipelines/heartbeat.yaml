apiVersion: tekton.dev/v1beta1
kind: Pipeline
metadata:
  name: heartbeat
  namespace: test-workloads
spec:
  workspaces:
    - name: cluster
  params:
    - name: PROW_JOB_ID
      type: string
    - name: PULL_PULL_SHA
      type: string
  tasks:
    - name: deploy-prometheus-meta-operator
      taskRef:
        name: opsctl-deploy
      params:
        - name: chart
          value: prometheus-meta-operator
        - name: ref
          value: "$(params.PULL_PULL_SHA)"
        - name: kubeconfig
          value: aws
      workspaces:
        - name: cluster
          workspace: cluster
  finally:
    - name: undeploy-prometheus-meta-operator
      taskRef:
        name: opsctl-undeploy
      params:
        - name: chart
          value: prometheus-meta-operator
        - name: ref
          value: "$(params.PULL_PULL_SHA)"
        - name: kubeconfig
          value: aws
      workspaces:
        - name: cluster
          workspace: cluster
