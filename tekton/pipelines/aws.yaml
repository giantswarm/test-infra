apiVersion: tekton.dev/v1beta1
kind: Pipeline
metadata:
  name: aws
  namespace: test-workloads
spec:
  resources:
  - name: releases
    type: git
  workspaces:
  - name: cluster
  tasks:
  - name: create-release
    taskRef:
      name: create-release
    workspaces:
    - name: cluster
      workspace: cluster
    resources:
      inputs:
      - name: releases
        resource: releases
  - name: upload-to-s3-bucket
    runAfter: [create-release]
    taskRef:
      name: upload-to-s3-bucket
    params:
    - name: prow-job-id
      value: "$(params.PROW_JOB_ID)"
    - name: file-to-upload
      value: $(workspaces.cluster.path)/release-id
    workspaces:
    - name: cluster
      workspace: cluster
